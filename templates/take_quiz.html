<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Take Quiz</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .timer-box {
            font-size: 18px;
            font-weight: bold;
            color: #dc3545;
            border: 2px solid #dc3545;
            padding: 8px 14px;
            border-radius: 8px;
        }
    </style>
</head>

<body class="bg-light">

<div class="container mt-4">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="text-primary">{{ quiz.title }} â€“ {{ chapter.title }}</h4>
        <div class="timer-box">
            Time Left: <span id="timer">00:00</span>
        </div>
    </div>

    <!-- Quiz Form -->
    <form id="quizForm" method="POST">

        {% if questions|length == 0 %}
            <div class="alert alert-danger text-center">
                No questions available.
            </div>
        {% else %}
            {% for question in questions %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body">

                    <h5>
                        Q{{ loop.index }}. {{ question.question_statement }}
                    </h5>

                    {% if question.question_image %}
                        <img src="{{ url_for('static', filename='uploads/' ~ question.question_image) }}"
                             class="img-fluid mb-2">
                    {% endif %}

                    <div class="form-check">
                        <input class="form-check-input" type="radio"
                               name="q{{ question.id }}" value="1" id="q{{ question.id }}_1">
                        <label class="form-check-label" for="q{{ question.id }}_1">{{ question.option_1 }}</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio"
                               name="q{{ question.id }}" value="2" id="q{{ question.id }}_2">
                        <label class="form-check-label" for="q{{ question.id }}_2">{{ question.option_2 }}</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio"
                               name="q{{ question.id }}" value="3" id="q{{ question.id }}_3">
                        <label class="form-check-label" for="q{{ question.id }}_3">{{ question.option_3 }}</label>
                    </div>

                    <div class="form-check">
                        <input class="form-check-input" type="radio"
                               name="q{{ question.id }}" value="4" id="q{{ question.id }}_4">
                        <label class="form-check-label" for="q{{ question.id }}_4">{{ question.option_4 }}</label>
                    </div>

                </div>
            </div>
            {% endfor %}

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg">
                    Submit Quiz
                </button>
            </div>
        {% endif %}

    </form>
</div>

<!-- TIMER SCRIPT -->
<script>
    let timeLeft = {{ time_limit }};
    const timer = document.getElementById("timer");

    function format(t) {
        let m = Math.floor(t / 60);
        let s = t % 60;
        return `${m}:${s < 10 ? '0' : ''}${s}`;
    }

    timer.innerText = format(timeLeft);

    const interval = setInterval(() => {
        timeLeft--;
        timer.innerText = format(timeLeft);

        if (timeLeft <= 0) {
            clearInterval(interval);
            alert("Time up! Quiz submitted.");
            document.getElementById("quizForm").submit();
        }
    }, 1000);
</script>

</body>
</html>
